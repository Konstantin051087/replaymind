{% extends "base.html" %}
{% block content %}
<h1>üîç ReplayMind ‚Äî –ò–ò –¥–ª—è –≥–µ–π–º–µ—Ä–æ–≤</h1>
{% if not is_premium %}
    <p>–û—Å—Ç–∞–ª–æ—Å—å –∑–∞–ø—Ä–æ—Å–æ–≤: <strong>{{ quota }}</strong> –∏–∑ 5</p>
    {% if quota <= 0 %}
        <p style="color:red;">–õ–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω. <a href="/premium">–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É</a>.</p>
    {% endif %}
{% else %}
    <p style="color:green;">‚úÖ –ü—Ä–µ–º–∏—É–º-–¥–æ—Å—Ç—É–ø –∞–∫—Ç–∏–≤–µ–Ω</p>
{% endif %}

<form id="analyzeForm">
    <label>–ò–≥—Ä–∞:</label>
    <select name="game" required>
        <option value="CS2">Counter-Strike 2</option>
        <option value="Elden Ring">Elden Ring</option>
        <option value="Valorant">Valorant</option>
        <option value="Dota 2">Dota 2</option>
    </select>
    <label>–°–∏—Ç—É–∞—Ü–∏—è:</label>
    <textarea name="description" placeholder="–û–ø–∏—à–∏—Ç–µ, –≥–¥–µ –≤—ã –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ—Ç–µ..." required></textarea>
    <button type="submit">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
</form>

<div id="result" style="display:none; margin-top:20px;">
    <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç:</h3>
    <p><strong>–û—à–∏–±–∫–∞:</strong> <span id="mistake"></span></p>
    <p><strong>–°–æ–≤–µ—Ç:</strong> <span id="advice"></span></p>
</div>

<script>
document.getElementById('analyzeForm').onsubmit = async (e) => {
    e.preventDefault();
    const data = {game: e.target.game.value, description: e.target.description.value};
    const res = await fetch('/analyze', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(data)});
    const json = await res.json();
    if (res.ok) {
        document.getElementById('mistake').textContent = json.mistake;
        document.getElementById('advice').textContent = json.advice;
        document.getElementById('result').style.display = 'block';
    } else {
        alert(json.error || '–û—à–∏–±–∫–∞');
    }
};
</script>
{% endblock %}
